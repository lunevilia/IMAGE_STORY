{% load information_extras %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/static/imagestory.ico">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script type="text/javascript" src="{% static 'jquery.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>
    <script>
        $('#loginmodal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever') // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
        })

        function modify_profile() {
            var r = confirm("ìˆ˜ì •ëœ ì •ë³´ë¡œ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
            if (r == true) {
                return true;
            } else {
                return false;
            }
        }

        function change_password() {
            if (document.getElementById("n_password").value == document.getElementById("c_password").value) {
                return true;
            } else {
                document.getElementById("check_password").innerHTML = "ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!"
                return false;
            }
        }

        function delete_profile() {
            var r = prompt("ì •ë§ë¡œ ì•„ì´ë””ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œë¥¼ ì›í•˜ë©´ \"ì‚­ì œ\"ë¥¼ ì…ë ¥í•˜ê³  í™•ì¸ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!\n(ì‚­ì œí•˜ë©´ ë³µêµ¬ëŠ” ë¶ˆê°€ëŠ¥ğŸš« í•©ë‹ˆë‹¤!)");
            if (r == "ì‚­ì œ") {
                location.href = "{% url 'account:del_user' %}";
                alert("ê·¸ ë™ì•ˆ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤!");
            } else {
                return;
            }
        }

        function rematch(x) {
            var nickname_check;
            if (x == "nickname_id") {
                nickname_check = false
                $('#modify_check').css("display", "block");
                $('#nickname_check').text("ì¤‘ë³µëœ í™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
                $('#nickname_check').css("color", "red");
                $('#modify_check').attr("disabled", false);
                if (1 >= $("#nickname_id").val().length) {
                    username_check = false
                    $('#modify_check').attr("disabled", true);
                    $('#nickname_check').text("ë‹‰ë„¤ì„ë¥¼ 2ê¸€ì ì´ìƒìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”!");
                    $('#nickname_check').css("color", "red");
                }
            }
            $('#modify_submit').attr("disabled", true);
            $('#overlap_id').text("ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
        }

        function modify_overlap(x, region) {
            $.ajax({
                // typeì„ ì„¤ì •í•©ë‹ˆë‹¤.
                type: 'GET',
                url: "{% url 'account:ajax' 'abc' 'region' %}".replace(/abc/, x.toString()).replace(/region/, region.toString()),
                success: function (data) {
                    // ë§Œì•½ ì£¼ëŠ” ë…€ì„ì´ regionì— ë”°ë¥¸ ë…€ì„ì´ë©´ regionì— ë”°ë¥¸ ë…€ì„ë§Œ ë³€ê²½
                    if (data["check"]) {
                        if (region == "nickname") {
                            $('#nickname_check').text("ì¤‘ë³µëœ ë‹‰ë„¤ì„ì´ ì¡´ì¬í•©ë‹ˆë‹¤");
                            $('#nickname_check').css("color", "red");
                            nickname_check = false;
                        }
                    } else {
                        if (region == "nickname") {
                            $('#nickname_check').text("ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤");
                            $('#nickname_check').css("color", "blue");
                            nickname_check = true;
                        }
                    }
                },
                error: function () {
                    if (region == "nickname") {
                        $('#nickname_check').text("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
                        nickname_check = false;
                    }
                },
                complete: function () {
                    if (nickname_check) {
                        $('#modify_submit').attr("disabled", false);
                    } else {
                        $('#modify_submit').attr("disabled", true);
                        $('#overlap_id').text("ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”!");
                    }
                }
            });
        }

    </script>

    <style>
        .btn-pink{
            background-color:  rgb(255, 169, 169);
            color: white;
        }
    </style>
    {% include 'notice_ajax.html' %}
    <style>
        .svg-icon {
            width: 1.5em;
            height: 1.5em;
            transition: 1s;
        }
    </style>
    <title>ì´ë¯¸ì§€ìŠ¤í† ë¦¬</title>
</head>

<body>
    <div class="container-fluid">
        {% include 'navbar.html' %}
        <!-- <h2 style="text-align: center;"><a href="/account/profile">{{user.profile.nickname}} í˜ì´ì§€</a></h2> -->

        <h2 style="text-align: center; margin-bottom: 10px;"><a style = "color:black; font-size: 1.1ch; font-weight: bold;" href="/account/profile">íšŒì›ì •ë³´</a></h2>

        <!--card start-->
        <div class="mb-3" style=" width:fit-content;margin:auto;padding: 20px;">

            <div style="text-align: center; width:350px; background-color:  rgb(224, 224, 224);" class="card-header">
                <div style="text-align: center;">
                    <p style = "font-weight: bold; font-size: 2.5ch;">í”„ë¡œí•„ ì‚¬ì§„</h4>
                    <p>{% if user.profile.image %}<img alt="{{user.profile.nickname}}"
                            style="border: solid; border-radius: 50px; border-color: white" width="110"
                            height="110" src="{{user.profile.image.url}}">
                            {% else %}<img alt="ì´ë¯¸ì§€ ì—†ìŒ"
                            style="border: solid; border-radius: 100px; border-color: white" width="120"
                            height="120" src = "{% static 'ì´ë¯¸ì§€ìŠ¤í† ë¦¬/í˜ì´ì§€_3/1x/ê¸€ì”¨ì—†ëŠ”.png' %}">{% endif %}
                    </p>
                </div>
                <table style="margin:auto;">
                    <tr>
                        <td><b>ë‹‰ë„¤ì„ &nbsp;&nbsp; </b></td>
                        <td style="text-align: center;">{{user.profile.nickname}}</td>
                    </tr>
                    <tr>
                        <td><b>ì´ë©”ì¼ &nbsp;&nbsp; </b></td>
                        <td>{{user.profile.email}}</td>
                    </tr>
                </table>
                <p></p>
            </div>

            <div class="card-body">

                <div style="text-align: center;">
                    <p><a href="{% url 'account:alert_board' %}" style = "color: rgb(158, 158, 158);">ì•Œë¦¼ë‚´ìš©</a></p>
                    <p><a href="{% url 'account:bookmark_board' %}" style = "color: rgb(158, 158, 158);">ë¶ë§ˆí¬</a></p>
                    <p><a href="{% url 'account:my_board' %}" style = "color: rgb(158, 158, 158);">ë‚´ ê²Œì‹œê¸€ ë° ê¶Œí•œ ê´€ë¦¬</a></p>
                    <p><a href="{% url 'account:auth_board' %}" style = "color: rgb(158, 158, 158);">ê¶Œí•œ ìˆëŠ” ê²Œì‹œê¸€</a></p>
                    <p><a style="color: black; font-weight: bold; cursor:pointer;" onclick="delete_profile()">íšŒì›íƒˆí‡´</a></p>
                </div>
            </div>
            <div style="text-align: center;" class="">
                <button type="button" class="btn btn-pink" data-toggle="modal" data-target="#exampleModal"
                    data-whatever="@mdo">ê°œì¸ì •ë³´ ìˆ˜ì •</button>
                <button type="button" class="btn btn-pink" data-toggle="modal" data-target="#passwordModal"
                    data-whatever="@mdo">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
            </div>
            {% if messages %}
            <div style="text-align: center;">
                {% for message in messages %}
                {{ message }}
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- íšŒì›ì •ë³´ ìˆ˜ì • modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">ì •ë³´ ìˆ˜ì •</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form onSubmit="return modify_profile()" action="{% url 'account:profile' %}"
                            enctype="multipart/form-data" method="post">
                            {% csrf_token %}
                            {{profile_form.as_p}}
                            <span id="nickname_check"></span>
                            <input style="display: none;" id="modify_check" type="button"
                                onclick="modify_overlap($('#nickname_id').val(), 'nickname');" value="ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">ì·¨ì†Œ</button>
                        <button id="modify_submit" type="submit" class="btn btn-pink">ìˆ˜ì •</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ modal -->
        <div class="modal fade" id="passwordModal" tabindex="-1" role="dialog" aria-labelledby="passwordModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="passwordModalLabel">ë¹„ë°€ë²ˆí˜¸ë³€ê²½</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form onSubmit="return change_password()" action="{% url 'account:mod_password' %}" method="POST">
                        {% csrf_token %}
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="n_password" class="col-form-label">ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸</label>
                                <input name="n_password" type="password" class="form-control" id="n_password"
                                    minlength="8" required>
                            </div>
                            <div class="form-group">
                                <label for="c_password" class="col-form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                                <input name="c_password" type="password" class="form-control" id="c_password"
                                    minlength="8" required>
                            </div>
                            <div id="check_password" style="text-align: center;"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">ì·¨ì†Œ</button>
                            <input type="submit" class="btn btn-pink" value="ë³€ê²½í•˜ê¸°">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>

</html>